/*
 Vanillabox
 (C) 2013 cocopon.

 Licensed under the MIT license:
 http://www.opensource.org/licenses/mit-license.php
*/
(function(e){function n(){}function r(e,t){return void 0!==e?e:t}function i(e){function t(){}t.prototype=w.prototype;e.prototype=new t}function s(e,t){var n=e.length,r;for(r=0;r<n;r++)t.call(this,e[r],r)}function o(e,t){var n=[],r=e.length,i;for(i=0;i<r;i++)n.push(t.call(this,e[i],i));return n}function u(){var t=new e.Deferred;setTimeout(function(){t.resolve()},0);return t.promise()}function a(){return!!navigator.userAgent.match(/(ipod|iphone|ipad)/ig)}function f(){}function p(){this.e()}function d(e){e=e||{};this.m=r(e.w,c);this.l=r(e.u,"both");this.e()}function v(t,n){var r=t.m;if(n!==t.c){if(t.c){t.B();var i=t.c;r.ea(i).done(function(){t.S(i)})}t.c=n;if(t.c){t.V();t.ia&&g(t);var s=t.a,o=t.c.a,u=s.find("> *");0===u.length?s.append(o):o.insertBefore(u.first());r.ta(t.c).done(function(){e(t).trigger("vnbx_content_show",[t,t.c])})}}}function m(e){e.ia={width:!0===e.l||"both"===e.l||"horizontal"===e.l?(window.innerWidth||document.documentElement.clientWidth)-100:Number.MAX_VALUE,height:!0===e.l||"both"===e.l||"vertical"===e.l?(window.innerHeight||document.documentElement.clientHeight)-100:Number.MAX_VALUE};e.c&&g(e)}function g(e){var t=e.ia;e.c.Z(Math.max(t.width,200),Math.max(t.height,150))}function y(e){e=e||{};this.d=new d({w:e.w,u:e.u});this.e();this.g()}function b(t,n){var r=t.d.a,i=r.width(),s=r.height();r.width(n.width);r.height(n.height);var o=e(window),u=t.a,a=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,a=Math.round(o.scrollLeft()+(a-u.outerWidth())/2),o=Math.max(Math.round(o.scrollTop()+(f-u.outerHeight())/2),0);r.width(i);r.height(s);return{left:a,top:o}}function w(e){e=e||{};this.wa=this.R=!1;this.sa=e.path;this.Ha=r(e.title,"");this.e()}function E(t,n){var r=t.a;t.R=!0;t.wa=n;r.removeClass("vnbx-loading");n||r.addClass("vnbx-error");e(t).trigger("vnbx_complete",n)}function S(e){w.call(this,e)}function x(e){w.call(this,e)}function T(e){e=e||{};this.Da=e.K;this.Ca=e.J;w.call(this,e)}function C(e){e=e||{};this.s=r(e.Ia,1);this.v=r(e.loop,!1);k(this,r(e.page,0))}function k(t,n){var r=t.i,i=t.s,i=Math.min(Math.max(n,0),i-1);t.i=i;r!==i&&e(t).trigger("vnbx_change")}function L(e){this.A=e.t;this.W=r(e.disabled,!1);this.e()}function A(e,t){var n=e.a;e.W=t;e.W?n.addClass("vnbx-disabled"):n.removeClass("vnbx-disabled")}function O(e){this.A=e.t;this.e()}function M(e){if(!e.ba||0===e.ba.length)throw new f;this.U=!1;this.N=e.ba;this.m=r(e.w,c);this.Fa=e.Ea;this.Ga=e.Ba;this.O=e.ya;this.l=e.u;this.Q=e.Aa;this.za={K:e.K,J:e.J,type:e.type};this.k=new C({loop:e.loop,Ia:this.N.length});this.e()}function _(t){t.p=o(t.N,function(n){n=e(n);var r=t.za,i=N[r.type];if(!i)throw new f;return i(n,r)});var n=new S;B(t,n)}function D(e){v(e.f.d,null);e.p&&(s(e.p,function(e){e.b()}),e.p=null)}function P(t){var n=e(window),r=e(document);n.on("resize",e.proxy(t.I,t));n.on("scroll",e.proxy(t.ra,t));r.on("keyup",e.proxy(t.la,t))}function H(t){var n=e(window),r=e(document);n.off("resize",t.I,t);n.off("scroll",t.ra,t);r.off("keyup",t.la,t)}function B(e,t){var n=e.f.d,r=e.f.d.c;r&&r.R&&r===t||(e.B(),v(n,t),e.V(),e.ca.a.text(t.Ha),t.load());n.C()}function j(e){var t=e.k;e.Y.a.text(String(t.i+1)+" of "+String(t.s));A(e.L,!(t.v||0<t.i));A(e.D,!(t.v||t.i<t.s-1));B(e,e.p[e.k.i])}function F(e){e.ha&&clearTimeout(e.ha);e.ha=setTimeout(function(){e.Fa&&e.m.T(e.f)},300)}var t;var l={va:function(e){return e.a.show().promise()},ga:function(e){return e.a.hide()},ua:function(e){l.T(e);return e.a.show().promise()},fa:function(e){return e.a.hide()},T:function(e){var t=e.d,n=t.q(),r=b(e,n);t.a.css({width:n.width,height:n.height});e.a.css({left:r.left,top:r.top});return u()},ta:function(e){return e.a.show().promise()},ea:function(e){return e.a.hide().promise()}},c={va:function(e){return e.a.fadeIn(200).promise()},ga:function(e){return e.a.fadeOut(300).promise()},xa:function(t,n,r,i){var s=t.d.a;s.stop();n=s.animate({width:n.width,height:n.height},i);t=t.a;t.stop();r=t.animate({left:r.left,top:r.top},i);return e.when(n,r)},ua:function(e){var t=e.d,n=t.q(),r=b(e,n);t.a.css({width:n.width,height:n.height});e.a.css({left:r.left,top:r.top});return u()},fa:function(){return u()},T:function(e){var t=e.d.q(),n=b(e,t);return c.xa(e,t,n,300)},ta:function(e){return e.a.fadeIn(200).promise()},ea:function(e){return e.a.fadeOut(300).promise()}};var h={none:l,"default":c};t=p.prototype;t.e=function(){var t=e("<div>");t.addClass("vnbx-mask");this.a=t;this.g()};t.b=function(){this.h();this.a=null};t.g=function(){e(window).on("resize",e.proxy(this.I,this));this.a.on("click",e.proxy(this.o,this))};t.h=function(){e(window).off("resize",this.I);this.a.off("click",this.o)};t.C=function(){var t=this.a;t.width("");t.height("");var n=e(window),r=e(document),i=Math.max(r.width(),n.width()),n=Math.max(r.height(),n.height());t.width(i);t.height(n)};t.I=function(){this.C()};t.o=function(){e(this).trigger("vnbx_click")};t=d.prototype;t.e=function(){var t=e("<div>");t.addClass("vnbx-container");this.a=t;this.g()};t.b=function(){this.h();this.a=null};t.g=function(){};t.h=function(){this.B()};t.V=function(){e(this.c).on("vnbx_complete",e.proxy(this.F,this))};t.B=function(){var t=this.c;t&&e(t).off("vnbx_complete",this.F)};t.q=function(){var e=this.c,t={width:0,height:0};e&&(t=e.q());return{width:Math.max(t.width,200),height:Math.max(t.height,150)}};t.C=function(){var e=this.c,t=e.q();e.a.css({marginLeft:-Math.round(t.width/2),marginTop:-Math.round(t.height/2)})};t.F=function(){this.C()};t.S=function(t){e(this).trigger("vnbx_content_hide",[this,t])};t=y.prototype;t.e=function(){var t=e("<div>");t.addClass("vnbx-frame");this.a=t;this.a.append(this.d.a)};t.b=function(){this.d.b();this.d=null;this.h();this.a=null};t.g=function(){this.a.on("click",e.proxy(this.o,this))};t.h=function(){this.a.off("click",this.o)};t.o=function(e){e.stopPropagation()};t=w.prototype;t.e=function(){var t=e("<div>");t.addClass("vnbx-content");this.a=t;this.$();this.g()};t.$=n;t.g=n;t.h=n;t.b=function(){this.h();this.a.remove();this.a=null};t.aa=function(){return!1};t.q=function(){var e=this.a;return{width:e.width(),height:e.height()}};t.Z=function(e,t){this.a.css({maxWidth:e,maxHeight:t})};t.load=function(){this.a.addClass("vnbx-loading");this.R?E(this,this.wa):this.X()};t.X=n;t.unload=function(){this.da();this.R=!1};t.da=n;i(S);S.prototype.e=function(){w.prototype.e.call(this);this.a.addClass("vnbx-empty")};S.prototype.load=function(){var t=this;setTimeout(function(){e(t).trigger("vnbx_complete",!0)},0)};i(x);t=x.prototype;t.$=function(){var t=e("<img>");this.a.append(t);this.r=t};t.b=function(){w.prototype.b.call(this);this.r=null};t.g=function(){var t=this.r;t.on("load",e.proxy(this.H,this));t.on("error",e.proxy(this.G,this))};t.h=function(){var e=this.r;e.off("load",this.H);e.off("error",this.G)};t.Z=function(e,t){this.r.css({maxWidth:e,maxHeight:t})};t.X=function(){this.r.attr("src",this.sa)};t.da=function(){this.r.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==")};t.H=function(){"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="!==this.r.attr("src")&&E(this,!0)};t.G=function(){E(this,!1)};i(T);t=T.prototype;t.$=function(){var t=e("<iframe>");t.attr("frameborder",0);this.a.append(t);this.j=t};t.b=function(){w.prototype.b.call(this);this.j=null};t.aa=function(){return!0};t.g=function(){var t=this.j;t.on("load",e.proxy(this.H,this));t.on("error",e.proxy(this.G,this))};t.h=function(){var e=this.j;e.off("load",this.H);e.off("error",this.G)};t.q=function(){var e=a()?this.a:this.j;return{width:e.width(),height:e.height()}};t.Z=function(e,t){(a()?this.a:this.j).css({maxWidth:e,maxHeight:t})};t.X=function(){this.j.attr("src",this.sa)};t.da=function(){this.j.attr("src","about:blank");var e=a()?this.a:this.j;e.width("");e.height("")};t.H=function(){var e=this.j.attr("src");e&&"about:blank"!==e&&(e=a()?this.a:this.j,e.width(this.Da),e.height(this.Ca),E(this,!0))};t.G=function(){E(this,!1)};var N={image:function(e){return new x({path:e.attr("href"),title:e.attr("title")})},iframe:function(e,t){return new T({path:e.attr("href"),K:t.K,J:t.J,title:e.attr("title")})}};C.prototype.next=function(){var t=this.s,n=this.i,r=n+1;r>t-1&&(r=this.v?0:t-1);this.i=r;n!==r&&e(this).trigger("vnbx_change")};C.prototype.M=function(){var t=this.s,n=this.i,r=n-1;0>r&&(r=this.v?t-1:0);this.i=r;n!==r&&e(this).trigger("vnbx_change")};t=L.prototype;t.e=function(){var t=e("<div>");t.addClass("vnbx-button");this.A&&t.addClass(this.A);t.attr("ontouchstart","void(0)");this.a=t;this.g()};t.b=function(){this.a=null};t.g=function(){this.a.on("click",e.proxy(this.o,this))};t.h=function(){this.a.off("click",this.o)};t.o=function(t){t.stopPropagation();this.W||e(this).trigger("vnbx_click")};O.prototype.e=function(){var t=e("<div>");t.addClass("vnbx-label");this.A&&t.addClass(this.A);this.a=t};O.prototype.b=function(){this.a=null};t=M.prototype;t.e=function(){var t=new p,n=t.a;n.addClass("vnbx");n.hide();e("body").append(n);this.n=t;t=this.n.a;a()&&t.addClass("vnbx-ios");this.O&&t.addClass("vnbx-close-button-enabled");this.Q&&1<this.k.s&&t.addClass("vnbx-group");var r=new y({w:this.m,u:this.l}),t=r.a;this.f=r;n.append(t);this.ca=n=new O({t:"vnbx-title"});t.append(n.a);this.Y=n=new O({t:"vnbx-pager"});t.append(n.a);this.L=n=new L({t:"vnbx-prev"});t.append(n.a);this.D=n=new L({t:"vnbx-next"});t.append(n.a);n=new L({t:"vnbx-close"});this.O||n.a.hide();this.P=n;t.append(n.a);this.g();_(this)};t.b=function(){H(this);this.h();D(this);this.ca.b();this.ca=null;this.Y.b();this.Y=null;this.P.b();this.P=null;this.L.b();this.L=null;this.D.b();this.D=null;this.f.b();this.f=null;this.n.a.remove();this.n.b();this.n=null};t.g=function(){this.N.on("click",e.proxy(this.qa,this));e(this.n).on("vnbx_click",e.proxy(this.ma,this));e(this.f.d).on("vnbx_content_hide",e.proxy(this.S,this));e(this.k).on("vnbx_change",e.proxy(this.oa,this));e(this.P).on("vnbx_click",e.proxy(this.ja,this));e(this.L).on("vnbx_click",e.proxy(this.pa,this));e(this.D).on("vnbx_click",e.proxy(this.na,this))};t.h=function(){this.N.off("click",this.qa);e(this.n).off("vnbx_click",this.ma);e(this.f.d).off("vnbx_content_hide",this.S);e(this.k).off("vnbx_change",this.oa);e(this.P).off("vnbx_click",this.ja);e(this.L).off("vnbx_click",this.pa);e(this.D).off("vnbx_click",this.na);this.B();this.c=null};t.V=function(){var t=this.f.d.c;e(t).on("vnbx_complete",e.proxy(this.F,this));t.a.on("click",e.proxy(this.ka,this))};t.B=function(){var t=this.f.d.c;t&&(e(t).off("complete",this.F),t.a.off("click",this.ka))};t.show=function(t){var n=this,i=n.m;if(n.U)return u();n.U=!0;null===n.p&&_(n);P(n);m(n.f.d);var s=n.n;s.C();var s=i.va(s),i=i.ua(n.f),o=n.k;t=r(t,0);var a=t!==o.i;k(o,t);a||j(n);return e.when(s,i).then(function(){e(n).trigger("vnbx_show")})};t.hide=function(){var t=this;return t.U?e.when(t.m.fa(t.f),t.m.ga(t.n)).then(function(){H(t);t.U=!1;s(t.p,function(e){e.aa()&&e.unload()});e(t).trigger("vnbx_hide")}):u()};t.M=function(){this.Q&&this.k.M()};t.next=function(){this.Q&&this.k.next()};t.I=function(){F(this)};t.ra=function(){F(this)};t.la=function(e){if(this.Ga)switch(e.keyCode){case 27:this.hide();break;case 37:this.M();break;case 39:this.next()}};t.qa=function(e){var t=this.N.index(e.delegateTarget);0>t||(e.preventDefault(),this.show(t))};t.oa=function(){j(this)};t.ma=function(){this.O||this.hide()};t.ja=function(){this.O&&this.hide()};t.pa=function(){this.M()};t.na=function(){this.next()};t.F=function(t,n){this.m.T(this.f);var r=t.target,i;e:{i=this.p;var s=i.length,o;for(o=0;o<s;o++)if(i[o]===r){i=o;break e}i=-1}0<=i&&e(this).trigger("vnbx_load",[n,r,i])};t.ka=function(e){var t=this.k;e.stopPropagation();this.Q?t.v||t.i<t.s-1?this.next():this.hide():this.hide()};t.S=function(e,t,n){n.aa()&&n.unload()};var I={animation:"default",closeButton:!1,adjustToWindow:"both",keyboard:!0,loop:!1,preferredHeight:600,preferredWidth:800,repositionOnScroll:!1,type:"image",grouping:!0};e.fn.Ja=function(t){var n={};e.extend(n,I);e.extend(n,t);t=e(this);return new M({w:h[n.animation]||c,ya:n.closeButton,u:n.adjustToWindow,Ba:n.keyboard,loop:n.loop,J:n.preferredHeight,K:n.preferredWidth,Ea:n.repositionOnScroll,ba:t,type:n.type,Aa:n.grouping})};e.fn.vanillabox=e.fn.Ja;M.prototype.dispose=M.prototype.b;M.prototype.hide=M.prototype.hide;M.prototype.next=M.prototype.next;M.prototype.previous=M.prototype.M;M.prototype.show=M.prototype.show})(jQuery)